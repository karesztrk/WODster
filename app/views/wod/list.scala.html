@(currentPage: dao.AbstractDAO.Page[model.training.Workout], currentSortBy: String, currentOrder: String, currentFilter: String, attendForm: Form[model.training.result.Attendance])

@import helper._
@import util.permission.Identity
@import controllers.WODController
@implicitFieldConstructor = @{ FieldConstructor(component.bootstrapInput.render) }
@authenticated = @{Identity.isAuthenticated()}
@import model.training.Workout.ResultMeasurementType

@main("wod") {
    
    <div class="layout layout-stack-sm layout-main-left">
    
    	<!-- Main -->
    	<div class="col-sm-7 col-md-8 layout-main">
    		
    		@for(post <- currentPage.getList) {
				<div class="feed-item feed-item-idea">
					
					<div class="feed-icon">
						<i class="fa fa-lightbulb-o"></i>
					</div>
					
					<div class="feed-subject">
						<p><a href="@routes.WODController.view(post.id)">@post.title</a></p>
	                </div>

                    <div class="feed-settings">
                        <div class="dropdown">
                            <a href="settings-dropdown" data-toggle="dropdown">
                                <i class="fa fa-caret-down"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="settings-dropdown">
                                <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href="@routes.WODController.view(post.id)">View</a>
                                </li>
                                <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href="@routes.WODController.edit(post.id)">Edit</a>
                                </li>
                            </ul>
                        </div>

                    </div>
	                
					<div class="feed-content">
						<ul class="icons-list">
							<li>
								
								<!-- Preview Image -->
								@if(util.asset.AssetUtils.isFileExist(post.image)) {
									<div style="width: 375px" class="thumbnail">
										<img alt="Post image" src="@routes.Assets.at(post.image)" class="img-responsive img-centered">
									</div>
								} 
								
								<!-- Post Content -->
								<i class="icon-li fa fa-quote-left"></i>
								<div >@Html(post.content)</div>

                    		</li>
						</ul>
					</div>
                
                	<div class="feed-actions">
                		@if(authenticated) {
						
							@if(WODController.isAttendee(post)) {
								<a class="pull-left" href="javascript:;" data-id="@post.id"><i class="fa fa-check-square-o"></i></a> 
							} else {
								<a class="pull-left attend" href="#attendModal" data-id="@post.id" data-type="@post.resultType" data-toggle="modal" ><i class="fa fa-square-o"></i></a> 
							}
						}
						<a class="pull-left" href="javascript:;"><i class="fa fa-thumbs-up"></i> 0</a> 
						<a class="pull-left" href="javascript:;"><i class="fa fa-comment-o"></i> @post.commentCount</a>
						
						<a class="pull-right" href="javascript:;"><i class="fa fa-clock-o"></i> @post.createdAt.format(util.Configuration.DATETIME_PATTERN)</a>
					</div>
			
					
				</div>
		    }
    	
    	</div>
    	
    	<!-- Sidebar -->
    	<div class="col-sm-5 col-md-4 layout-sidebar">
    	
    		<div class="portlet">
    			
    			@if(authenticated) {
					<a href="@routes.WODController.create()" class="btn btn-primary btn-jumbo btn-block ">New WOD</a>

                    <a class="btn btn-secondary btn-lg btn-block " href="javascript:;">New Template</a>
				}
    			
    		</div>

            <h4>Recent Activity</h4>
            <div class="well">

                <ul class="icons-list text-md">
                    <li>
                        <i class="icon-li fa fa-comments-o text-success"></i>
                        <strong>New Comment!</strong>
                        <br>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </li>
                    <li>
                        <i class="icon-li fa fa-check-square text-secondary"></i>
                        <strong>New Action!</strong>
                        <br>
                        Vestibulum iaculis felis eu eros pellentesque placerat.
                    </li>
                    <li>
                        <i class="icon-li fa fa-truck text-tertiary"></i>
                        <strong>New Product!</strong>
                        <br>
                        Curabitur cursus nisl et mauris imperdiet porttitor.
                    </li>
                    <li>
                        <i class="icon-li fa fa-comments-o text-primary"></i>
                        <strong>New Comment!</strong>
                        <br>
                        Vestibulum iaculis felis eu eros pellentesque placerat.
                    </li>
                    <li>
                        <i class="icon-li fa fa-comments-o text-primary"></i>
                        <strong>New Comment!</strong>
                        <br>
                        Curabitur cursus nisl et mauris imperdiet porttitor.
                    </li>
                </ul>
            </div>
    	</div>
    
    </div>
		<!--  Add this to the navbar after all
	    <div class="col-md-4">
			<div class="well">
			    <h4>WOD Search</h4>
			    @form(routes.WODController.list(0, "", "", ""), 'method -> "GET") {
				    <div class="input-group">
				        <input type="search" name="f" class="form-control" placeholder="Filter by title..." value="@currentFilter">
				        <span class="input-group-btn">
				            <input type="submit" class="btn btn-default" value="Search">
				                <span class="glyphicon glyphicon-search"></span>
				        	</input>
				        </span>
				    </div>
				}
			</div>
	    </div>
	    -->
	
	<div class="modal fade" id="attendModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<h4 class="modal-title" id="myModalLabel">Attend</h4>
				</div>
				@form(routes.WODController.attend(), 'id -> "attendForm", 'class -> "form parsley-form", Symbol("data-validate") -> "parsley") {
					<div class="modal-body">
						<input type="hidden" name="wodId" id="wodId" value="" />
						
						@component.datePicker(attendForm("date"), '_label -> "Workout date:", 'class -> "form-control", '_showHelp -> false)
						@component.timePicker(attendForm("timeResult"), '_label -> "Your result:", 'class -> "form-control", 'placeholder -> "Pick your result time...", '_showHelp -> false, 'style -> "display: none;")
						@inputText(attendForm("result"), '_label -> "Your result:", 'class -> "form-control parsley-validated", Symbol("data-type") -> "digits", 'placeholder -> "Add your result...", '_showHelp -> false, 'style -> "display: none;") 
						@textarea(attendForm("note"), '_label -> null, 'placeholder -> "Add a note...", 'class -> "form-control")
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Save changes</button>
					</div>
				}
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
		/*$("div.post_content").text(function(index, currentText) {
			
			var charLimit = 100;
			if(currentText.length > charLimit) {
				var content = currentText.substr(0, 100);
			    return currentText.substr(0, 100) + '...';
			}
			
			return currentText;
		});*/
		
		$(document).ready(function()
		{
			
			$(".attend").click(function()
				{
					var btn = $(this);
					var id = btn.attr('data-id');
					var type = btn.attr('data-type');
					$("#wodId").val(id);
					
					if('TIME' == type) {
						var elem = $("#result");
						elem.closest(".form-group").children().attr('style','display:none !important');
						//$("label[for='result']").hide();
						
						var elem = $("#timeResult");
						elem.closest(".form-group").children().show();
						//$("label[for='timeResult']").show();
					} else {
						var elem = $("#result");
						//$("label[for='result']").show();
						elem.closest(".form-group").children().show();
						
						var elem = $("#timeResult");
						//$("label[for='timeResult']").hide();
						elem.closest(".form-group").children().attr('style','display:none !important');
					}
				});
			
			$("#attendForm").submit(function(e)
				{
					var form = $(this);
					var formData = form.serializeArray();
					var formURL = form.attr("action");
					
					// stop the form from submitting the normal way and refreshing the page
					e.preventDefault();
					if (form.parsley().isValid()) {
						$.ajax(
						{
							url : formURL,
							type: "POST",
							data : formData,
							success: function(data, textStatus, jqXHR)
							{
								var btn = $("a[data-id=" + formData[0].value + "]");
								var icon = btn.children("i");
								if(!btn.hasClass('fa-check-square-o')) {
									btn.attr("href", "#");
									icon.removeClass('fa-square-o').addClass('fa-check-square-o');
								}
								$('#attendModal').modal('hide');
								form.trigger("reset");
							},
							error: function(jqXHR, textStatus, errorThrown)
							{
								// TODO
								alert('Error ' + textStatus + ' ' + errorThrown);
							}
						});
					}
				});
		});
	</script>
}

            