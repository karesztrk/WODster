@(currentPage: dao.AbstractDAO.Page[model.journal.PersonalRecord], currentSortBy: String, currentOrder: String, currentFilter: String)

@import helper._
@authenticated = @{util.permission.Identity.isAuthenticated()}
@import model.training.Workout.ResultMeasurementType
@import util.format.DateTimeFormatter

@****************************************
* Helper generating navigation links    *
****************************************@
@link(newPage:Int, newSortBy:String) = @{
    
    var sortBy = currentSortBy
    var order = currentOrder
    
    if(newSortBy != null) {
        sortBy = newSortBy
        if(currentSortBy == newSortBy) {
            if(currentOrder == "asc") {
                order = "desc"
            } else {
                order = "asc"
            }
        } else {
            order = "asc"
        }
    }
    
    // Generate the link
    routes.PersonalRecordController.list(newPage, sortBy, order, currentFilter)
    
}

@**********************************
* Helper generating table headers *
***********************************@
@header(key:String, title:String) = {
    <th class="@key.replace(".","_") header @if(currentSortBy == key) @{if(currentOrder == "asc") "headerSortDown" else "headerSortUp"}">
        <a href="@link(0, key)">@title</a>
    </th>
}

@main("journal") {
    
    <h1>Personal Records</h1>
    
	@if(authenticated) {
		<a href="@routes.PersonalRecordController.create()"> <button class="btn btn-primary">New <span class="glyphicon glyphicon-plus"></span></button></a>
	}
    
    <table class="table table-striped table-bordered dataTable">
	    <thead>
	        <tr>
	            @header("name", "Name")
	            @header("date", "Date")
	            @header("description", "Result")
	            @header("actions", "")
	        </tr>
	    </thead>
	    <tbody>
	
	        @for(record <- currentPage.getList) {
	            <tr>
	                <td><a href="#">@record.name</a></td>
	                <td>@record.date.format("yyyy MMM dd")</td>
	                
	                @if(ResultMeasurementType.TIME == record.workout.resultType) {
	                	<td>@DateTimeFormatter.formatTime(record.result)</td>
	                } else {
	                	<td>@record.result</td>
	                }
	                
	                <td class="text-right">
	                	@form(routes.PersonalRecordController.delete(record.id)) {
	                		<button class="btn btn-link btn-sm" type="submit"><i class="glyphicon glyphicon-remove"></i></button>
	                	} 
	                </td>
	            </tr>
	        }
	
	    </tbody>
	</table>
	
	<div class="row dt-rb">
		<div class="col-sm-6">
			<div class="dataTables_info" id="table-1_info">
				@currentPage.getDisplayXtoYofZ()
			</div>
		</div>
		<div class="col-sm-6">
			<div class="dataTables_paginate paging_bootstrap">
				<ul class="pagination">
		           <li class="@if(!currentPage.hasPrev) {disabled}">
		               <a href="@link(currentPage.getPageIndex - 1, null)">Previous</a>
		           </li>
			        
		            <li class="@if(!currentPage.hasNext) {disabled}">
		               <a href="@link(currentPage.getPageIndex + 1, null)">Next</a>
		            </li>
			    </ul>
		    </div>
	    </div>
    </div>
	
}

            